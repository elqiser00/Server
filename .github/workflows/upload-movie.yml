name: ğŸ¬ Ø±ÙØ¹ Ø£ÙÙ„Ø§Ù… Ø¥Ù„Ù‰ ØªÙ„ÙŠØ¬Ø±Ø§Ù…

on:
  workflow_dispatch:
    inputs:
      channel_link:
        description: 'Ø±Ø§Ø¨Ø· Ø§Ù„Ù‚Ù†Ø§Ø© (Ù…Ø«Ø§Ù„: https://t.me/+xxxxxxxxxx)'
        required: true
        type: string
      movie_name:
        description: 'Ø§Ø³Ù… Ø§Ù„ÙÙŠÙ„Ù…'
        required: true
        type: string
      poster_url:
        description: 'Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© (ØµÙŠØºØ© jpg, png, webp)'
        required: true
        type: string
      video_url:
        description: 'Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ (ØµÙŠØºØ© mp4)'
        required: true
        type: string

jobs:
  upload-movie:
    runs-on: ubuntu-latest
    timeout-minutes: 45
    
    steps:
    - name: ğŸ“¦ ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª
      run: |
        echo "ØªØ«Ø¨ÙŠØª Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©..."
        sudo apt update
        sudo apt install -y python3 python3-pip curl ffmpeg
        pip3 install telethon
        
    - name: ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª
      run: |
        echo "ØªØ­Ù…ÙŠÙ„ Ù…Ù„ÙØ§Øª Ø§Ù„ÙÙŠÙ„Ù…..."
        curl -L --insecure --max-time 300 -o poster.jpg "${{ github.event.inputs.poster_url }}"
        curl -L --insecure --max-time 600 -o video.mp4 "${{ github.event.inputs.video_url }}"
        
        echo "ğŸ“Š Ø­Ø¬Ù… Ø§Ù„Ù…Ù„ÙØ§Øª:"
        ls -lh poster.jpg video.mp4
        
    - name: ğŸ“¤ Ø±ÙØ¹ Ø¥Ù„Ù‰ ØªÙ„ÙŠØ¬Ø±Ø§Ù…
      env:
        TELEGRAM_API_ID: ${{ secrets.TELEGRAM_API_ID }}
        TELEGRAM_API_HASH: ${{ secrets.TELEGRAM_API_HASH }}
        TELEGRAM_SESSION_STRING: ${{ secrets.TELEGRAM_SESSION_STRING }}
      run: |
        echo "ğŸš€ Ø¨Ø¯Ø¡ Ø±ÙØ¹ Ø§Ù„ÙÙŠÙ„Ù…: ${{ github.event.inputs.movie_name }}"
        
        python3 -c '
import asyncio, os
from telethon import TelegramClient
from telethon.sessions import StringSession

print("ğŸ”— Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…...")

async def main():
    # Ø§Ù„Ø§ØªØµØ§Ù„
    client = TelegramClient(
        StringSession(os.environ["TELEGRAM_SESSION_STRING"]),
        int(os.environ["TELEGRAM_API_ID"]),
        os.environ["TELEGRAM_API_HASH"]
    )
    
    await client.connect()
    
    if not await client.is_user_authorized():
        print("âŒ Ø®Ø·Ø£: Ø§Ù„Ø¬Ù„Ø³Ø© ØºÙŠØ± ØµØ§Ù„Ø­Ø©!")
        return
    
    me = await client.get_me()
    print(f"âœ… Ù…ØªØµÙ„ Ø¨Ù€: {me.first_name} (@{me.username})")
    
    # Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ù†Ø§Ø©
    try:
        channel = await client.get_entity("${{ github.event.inputs.channel_link }}")
        print(f"ğŸ“¢ Ø§Ù„Ù‚Ù†Ø§Ø©: {channel.title}")
    except Exception as e:
        print(f"âŒ Ø®Ø·Ø£: Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù‚Ù†Ø§Ø©: {e}")
        return
    
    # Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø©
    print("ğŸ–¼ï¸ Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø©...")
    try:
        await client.send_file(
            channel,
            "poster.jpg",
            caption="ğŸ¬ ${{ github.event.inputs.movie_name }}",
            parse_mode="html"
        )
        print("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø©")
    except Exception as e:
        print(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø©: {e}")
    
    # Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
    print("ğŸ¥ Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ...")
    try:
        video_size = os.path.getsize("video.mp4") / (1024 * 1024)
        caption = f"ğŸ¥ ${{ github.event.inputs.movie_name }}\\nâœ… ÙÙŠÙ„Ù… ÙƒØ§Ù…Ù„\\nğŸ“Š Ø§Ù„Ø­Ø¬Ù…: {video_size:.2f} MB"
        await client.send_file(
            channel,
            "video.mp4",
            caption=caption,
            parse_mode="html",
            supports_streaming=True
        )
        print("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ")
    except Exception as e:
        print(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ: {e}")
    
    # Ø¥Ù†Ù‡Ø§Ø¡
    await client.disconnect()
    print("ğŸ‰ ØªÙ… Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ø¨Ù†Ø¬Ø§Ø­!")

asyncio.run(main())
'
        
        # ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ù„ÙØ§Øª
        rm -f poster.jpg video.mp4
        echo "ğŸ ØªÙ… ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø¤Ù‚ØªØ©"
