name: ğŸ¬ Ø±ÙØ¹ ÙÙŠÙ„Ù… - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ

on:
  workflow_dispatch:
    inputs:
      channel_link:
        description: 'Ø±Ø§Ø¨Ø· Ø§Ù„Ù‚Ù†Ø§Ø©'
        required: true
        type: string
      movie_name:
        description: 'Ø§Ø³Ù… Ø§Ù„ÙÙŠÙ„Ù…'
        required: true
        type: string
      poster_url:
        description: 'Ø±Ø§Ø¨Ø· Ø§Ù„Ø¨ÙˆØ³ØªØ±'
        required: true
        type: string
      video_url:
        description: 'Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± mp4'
        required: true
        type: string

jobs:
  upload:
    runs-on: ubuntu-latest
    timeout-minutes: 30

    steps:
    - name: ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª
      run: |
        sudo apt update
        sudo apt install -y python3 python3-pip curl ffmpeg
        pip3 install telethon

    - name: Ø±ÙØ¹ Ø§Ù„ÙÙŠÙ„Ù… Ø¥Ù„Ù‰ ØªÙ„ÙŠØ¬Ø±Ø§Ù…
      env:
        TELEGRAM_API_ID: ${{ secrets.TELEGRAM_API_ID }}
        TELEGRAM_API_HASH: ${{ secrets.TELEGRAM_API_HASH }}
        TELEGRAM_SESSION_STRING: ${{ secrets.TELEGRAM_SESSION_STRING }}
        CHANNEL_LINK: ${{ github.event.inputs.channel_link }}
        MOVIE_NAME: ${{ github.event.inputs.movie_name }}
        POSTER_URL: ${{ github.event.inputs.poster_url }}
        VIDEO_URL: ${{ github.event.inputs.video_url }}
      run: |
        echo "ğŸš€ Ø¨Ø¯Ø¡ Ø±ÙØ¹ Ø§Ù„ÙÙŠÙ„Ù…: $MOVIE_NAME"
        echo "=================================="
        
        # ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª
        echo "ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª..."
        curl -L --insecure --max-time 300 --output poster.jpg "$POSTER_URL"
        curl -L --insecure --max-time 600 --output video.mp4 "$VIDEO_URL"
        
        echo "ğŸ“Š Ø­Ø¬Ù… Ø§Ù„Ù…Ù„ÙØ§Øª:"
        ls -la poster.jpg video.mp4
        
        # Ø¥Ù†Ø´Ø§Ø¡ ÙˆØªØ´ØºÙŠÙ„ Ø³ÙƒØ±Ø¨Øª Python
        python3 -c "
import asyncio, os
from telethon import TelegramClient
from telethon.sessions import StringSession

async def main():
    try:
        print('ğŸ”— Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…...')
        
        client = TelegramClient(
            StringSession('$TELEGRAM_SESSION_STRING'),
            $TELEGRAM_API_ID,
            '$TELEGRAM_API_HASH'
        )
        
        await client.connect()
        
        if not await client.is_user_authorized():
            print('âŒ Ø¬Ù„Ø³Ø© ØºÙŠØ± ØµØ§Ù„Ø­Ø©')
            return
        
        me = await client.get_me()
        print(f'âœ… Ù…ØªØµÙ„ Ø¨Ù€: {me.first_name}')
        
        # Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ù†Ø§Ø©
        print(f'ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù‚Ù†Ø§Ø©: $CHANNEL_LINK')
        channel = await client.get_entity('$CHANNEL_LINK')
        print(f'ğŸ“¢ Ø§Ù„Ù‚Ù†Ø§Ø©: {channel.title}')
        
        # Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø©
        print('ğŸ–¼ï¸ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø©...')
        await client.send_file(
            channel,
            'poster.jpg',
            caption='ğŸ¬ $MOVIE_NAME',
            parse_mode='html'
        )
        
        # Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
        print('ğŸ¥ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ...')
        video_size = os.path.getsize('video.mp4') / (1024 * 1024)
        await client.send_file(
            channel,
            'video.mp4',
            caption=f'ğŸ¥ $MOVIE_NAME\\nâœ… ÙÙŠÙ„Ù… ÙƒØ§Ù…Ù„\\nğŸ“Š Ø§Ù„Ø­Ø¬Ù…: {video_size:.2f} MB',
            parse_mode='html',
            supports_streaming=True
        )
        
        print('âœ…âœ…âœ… ØªÙ… Ø§Ù„Ø±ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­! âœ…âœ…âœ…')
        
        await client.disconnect()
        
        # ØªÙ†Ø¸ÙŠÙ
        os.remove('poster.jpg')
        os.remove('video.mp4')
        
    except Exception as e:
        print(f'âŒâŒâŒ Ø®Ø·Ø£: {e}')
        raise

asyncio.run(main())
        "
        
        echo "ğŸ Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ØªÙ†ÙÙŠØ°"
