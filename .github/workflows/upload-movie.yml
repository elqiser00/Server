name: ðŸŽ¬ Ø±ÙØ¹ Ø£ÙÙ„Ø§Ù… Ø¥Ù„Ù‰ ØªÙ„ÙŠØ¬Ø±Ø§Ù…

on:
  workflow_dispatch:
    inputs:
      channel_link:
        description: 'Ø±Ø§Ø¨Ø· Ø§Ù„Ù‚Ù†Ø§Ø©'
        required: true
        type: string
      movie_name:
        description: 'Ø§Ø³Ù… Ø§Ù„ÙÙŠÙ„Ù…'
        required: true
        type: string
      poster_url:
        description: 'Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©'
        required: true
        type: string
      video_url:
        description: 'Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ'
        required: true
        type: string

jobs:
  upload:
    runs-on: ubuntu-latest
    timeout-minutes: 45
    
    steps:
    - name: ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª
      run: |
        sudo apt update
        sudo apt install -y python3 python3-pip curl ffmpeg
        pip3 install telethon
        
    - name: ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª
      run: |
        curl -L --insecure -o poster.jpg "${{ github.event.inputs.poster_url }}"
        curl -L --insecure -o video.mp4 "${{ github.event.inputs.video_url }}"
        echo "ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª"
        ls -la poster.jpg video.mp4
        
    - name: Ø±ÙØ¹ Ø¥Ù„Ù‰ ØªÙ„ÙŠØ¬Ø±Ø§Ù…
      env:
        TELEGRAM_API_ID: ${{ secrets.TELEGRAM_API_ID }}
        TELEGRAM_API_HASH: ${{ secrets.TELEGRAM_API_HASH }}
        TELEGRAM_SESSION_STRING: ${{ secrets.TELEGRAM_SESSION_STRING }}
      run: |
        cat > upload_script.py << 'EOF'
import asyncio, os
from telethon import TelegramClient
from telethon.sessions import StringSession

print("ðŸš€ Ø¨Ø¯Ø¡ Ø±ÙØ¹ Ø§Ù„ÙÙŠÙ„Ù…")

async def main():
    # Ø§Ù„Ø§ØªØµØ§Ù„
    client = TelegramClient(
        StringSession(os.environ["TELEGRAM_SESSION_STRING"]),
        int(os.environ["TELEGRAM_API_ID"]),
        os.environ["TELEGRAM_API_HASH"]
    )
    
    await client.connect()
    
    if not await client.is_user_authorized():
        print("âŒ Ø¬Ù„Ø³Ø© ØºÙŠØ± ØµØ§Ù„Ø­Ø©")
        return
    
    me = await client.get_me()
    print(f"âœ… Ù…ØªØµÙ„ Ø¨Ù€: {me.first_name}")
    
    # Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ù†Ø§Ø©
    try:
        channel = await client.get_entity("${{ github.event.inputs.channel_link }}")
        print(f"ðŸ“¢ Ø§Ù„Ù‚Ù†Ø§Ø©: {channel.title}")
    except Exception as e:
        print(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù‚Ù†Ø§Ø©: {e}")
        return
    
    # Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø©
    print("ðŸ–¼ï¸ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø©...")
    try:
        await client.send_file(
            channel,
            "poster.jpg",
            caption="ðŸŽ¬ ${{ github.event.inputs.movie_name }}"
        )
        print("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø©")
    except Exception as e:
        print(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØµÙˆØ±Ø©: {e}")
    
    # Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
    print("ðŸŽ¥ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ...")
    try:
        video_size = os.path.getsize("video.mp4") / (1024 * 1024)
        caption = f"ðŸŽ¥ ${{ github.event.inputs.movie_name }}\\nâœ… ÙÙŠÙ„Ù… ÙƒØ§Ù…Ù„\\nðŸ“Š Ø§Ù„Ø­Ø¬Ù…: {video_size:.2f} MB"
        await client.send_file(
            channel,
            "video.mp4",
            caption=caption,
            supports_streaming=True
        )
        print("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ")
    except Exception as e:
        print(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ: {e}")
    
    await client.disconnect()
    print("ðŸŽ‰ ØªÙ… Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡!")

asyncio.run(main())
EOF
        
        python3 upload_script.py
        
        # ØªÙ†Ø¸ÙŠÙ
        rm -f poster.jpg video.mp4 upload_script.py
        echo "ðŸ ØªÙ… Ø§Ù„ØªÙ†Ø¸ÙŠÙ"
