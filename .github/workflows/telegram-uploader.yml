# .github/workflows/telegram-uploader.yml
name: Upload Movie Album

on:
  workflow_dispatch:
    inputs:
      invite_link:
        description: 'Ø±Ø§Ø¨Ø· Ø¯Ø¹ÙˆØ© Ø§Ù„Ù‚Ù†Ø§Ø©'
        required: true
        default: 'https://t.me/+VvLRMffUCXNlNjRk'
        type: string
      content_name:
        description: 'Ø§Ø³Ù… Ø§Ù„ÙÙŠÙ„Ù…'
        required: true
        default: 'Truth & Treason 2025'
        type: string
      image_url:
        description: 'Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„ØºÙ„Ø§Ù'
        required: true
        default: 'https://img.downet.net/uploads/U8xQf.webp'
        type: string
      video_url:
        description: 'Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ'
        required: true
        type: string

jobs:
  upload:
    runs-on: ubuntu-latest
    
    steps:
    - name: âš™ï¸ ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª
      run: |
        sudo apt-get update
        sudo apt-get install -y python3 python3-pip wget
        pip3 install telethon --quiet
        
    - name: ðŸ“ Ø¥Ù†Ø´Ø§Ø¡ Ø³ÙƒØ±Ø¨Øª Ø§Ù„Ø£Ù„Ø¨ÙˆÙ…
      run: |
        cat > upload_album.py << 'EOF'
        import asyncio
        import os
        import sys
        import subprocess
        
        print("ðŸš€ Ø±ÙØ¹ Ø£Ù„Ø¨ÙˆÙ…: ØµÙˆØ±Ø© + ÙÙŠØ¯ÙŠÙˆ")
        print("=" * 50)
        
        # Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        API_ID = int(os.environ.get('TELEGRAM_API_ID', '0'))
        API_HASH = os.environ.get('TELEGRAM_API_HASH', '')
        SESSION_STRING = os.environ.get('TELEGRAM_SESSION_STRING', '')
        
        INVITE_LINK = os.environ.get('INVITE_LINK', 'https://t.me/+VvLRMffUCXNlNjRk')
        CONTENT_NAME = os.environ.get('CONTENT_NAME', 'Truth & Treason 2025')
        IMAGE_URL = os.environ.get('IMAGE_URL', '')
        VIDEO_URL = os.environ.get('VIDEO_URL', '')
        
        print(f"ðŸŽ¬ Ø§Ù„ÙÙŠÙ„Ù…: {CONTENT_NAME}")
        
        from telethon import TelegramClient
        from telethon.sessions import StringSession
        from telethon.tl.types import InputMediaUploadedPhoto, InputMediaUploadedDocument
        
        async def main():
            print("\nðŸ”Œ Ø§Ù„Ø§ØªØµØ§Ù„...")
            
            client = None
            try:
                # Ø§Ù„Ø§ØªØµØ§Ù„
                client = TelegramClient(StringSession(SESSION_STRING), API_ID, API_HASH)
                await client.connect()
                
                if not await client.is_user_authorized():
                    print("âŒ Ø¬Ù„Ø³Ø© ØºÙŠØ± ØµØ§Ù„Ø­Ø©!")
                    return
                
                me = await client.get_me()
                print(f"âœ… Ù…ØªØµÙ„: @{me.username}")
                
                # Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù‚Ù†Ø§Ø©
                print(f"\nðŸ“¢ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù‚Ù†Ø§Ø©...")
                channel = await client.get_entity(INVITE_LINK)
                print(f"âœ… Ø§Ù„Ù‚Ù†Ø§Ø©: {channel.title}")
                
                # ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª
                print(f"\nâ¬‡ï¸  ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª...")
                
                # 1. ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©
                subprocess.run([
                    'wget', '-q', '--show-progress',
                    '-O', 'poster.jpg',
                    IMAGE_URL
                ], check=True)
                print("âœ… ØªÙ… ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©")
                
                # 2. ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
                print("â¬‡ï¸  Ø¬Ø§Ø±ÙŠ ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ...")
                subprocess.run([
                    'wget',
                    '--no-check-certificate',
                    '-c',
                    '--timeout=300',
                    '--tries=3',
                    '-O', 'movie.mp4',
                    VIDEO_URL
                ], check=True)
                print("âœ… ØªÙ… ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ")
                
                # â­â­ Ø±ÙØ¹ ÙƒØ£Ù„Ø¨ÙˆÙ… â­â­
                print(f"\nðŸ“¦ Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„Ø£Ù„Ø¨ÙˆÙ…...")
                
                # Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø£ÙˆÙ„Ø§Ù‹
                print("ðŸ“¸ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©...")
                photo_result = await client.upload_file('poster.jpg')
                
                # Ø±ÙØ¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
                print("ðŸŽ¥ Ø±ÙØ¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ...")
                video_result = await client.upload_file('movie.mp4')
                
                # â­ Ø¥Ù†Ø´Ø§Ø¡ Ø£Ù„Ø¨ÙˆÙ… â­
                await client.send_file(
                    channel.id,
                    file=[
                        photo_result,  # Ø§Ù„ØµÙˆØ±Ø© Ø£ÙˆÙ„Ø§Ù‹ (Ø³ØªØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰/Ø§Ù„ÙŠØ³Ø§Ø± Ø­Ø³Ø¨ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚)
                        video_result   # Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø«Ø§Ù†ÙŠØ§Ù‹ (Ø³ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„/Ø§Ù„ÙŠÙ…ÙŠÙ†)
                    ],
                    caption=f'ðŸŽ¬ **{CONTENT_NAME}**\nðŸ“¸ Ø¨ÙˆØ³ØªØ± | ðŸŽ¥ ÙÙŠÙ„Ù… ÙƒØ§Ù…Ù„\nâœ… ØªÙ… Ø§Ù„Ø±ÙØ¹'
                )
                
                print("\n" + "=" * 50)
                print("âœ… ØªÙ… Ø±ÙØ¹ Ø§Ù„Ø£Ù„Ø¨ÙˆÙ… Ø¨Ù†Ø¬Ø§Ø­!")
                print("ðŸ“¸ Ø§Ù„ØµÙˆØ±Ø©: Ø£Ø¹Ù„Ù‰/ÙŠØ³Ø§Ø±")
                print("ðŸŽ¥ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ: Ø£Ø³ÙÙ„/ÙŠÙ…ÙŠÙ†")
                print("=" * 50)
                
                return True
                
            except Exception as e:
                print(f"âŒ Ø®Ø·Ø£: {e}")
                return False
                
            finally:
                # ØªÙ†Ø¸ÙŠÙ
                for file in ['poster.jpg', 'movie.mp4']:
                    if os.path.exists(file):
                        os.remove(file)
                
                if client:
                    await client.disconnect()
                    print("\nðŸ”’ ØªÙ… Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„")
        
        if __name__ == "__main__":
            asyncio.run(main())
        EOF
        
    - name: âš¡ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø±ÙØ¹
      env:
        TELEGRAM_API_ID: ${{ secrets.TELEGRAM_API_ID }}
        TELEGRAM_API_HASH: ${{ secrets.TELEGRAM_API_HASH }}
        TELEGRAM_SESSION_STRING: ${{ secrets.TELEGRAM_SESSION_STRING }}
        INVITE_LINK: ${{ github.event.inputs.invite_link }}
        CONTENT_NAME: ${{ github.event.inputs.content_name }}
        IMAGE_URL: ${{ github.event.inputs.image_url }}
        VIDEO_URL: ${{ github.event.inputs.video_url }}
      run: |
        echo "âš¡ Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„Ø£Ù„Ø¨ÙˆÙ…..."
        python3 upload_album.py
