name: ๐ค ุฑูุน ูุญุชูู ุนูู ุชูููุฌุฑุงู - ุงูุฅุตุฏุงุฑ ุงูููุงุฆู ูุน ุชูุงุตูู ุงูููุฏูู

on:
  workflow_dispatch:
    inputs:
      mode:
        description: 'ุงููุถุน (ุงุฎุชุฑ: movie ููุฃููุงู / series ูููุณูุณูุงุช)'
        required: true
        default: 'movie'
        type: choice
        options:
          - movie
          - series
      
      channel:
        description: 'ุฑุงุจุท ุงูููุงุฉ: @yourchannel ุฃู ุฑุงุจุท ุฏุนูุฉ (ูุซู +Abc123)'
        required: true
        type: string
      
      caption:
        description: 'ุงููุงุจุดู/ุงููุตู (ุงุณุชุฎุฏู \\n ูููุตู ุจูู ุงูุฃุณุทุฑ)'
        required: true
        type: string
      
      # ุฅุนุฏุงุฏุงุช ูุถุน ุงูุฃููุงู
      image_url:
        description: 'ุฑุงุจุท ูุจุงุดุฑ ููุตูุฑุฉ (ููุถุน ุงูุฃููุงู ููุท) - ุณูุชู ุชุณููุชูุง ุชููุงุฆูุงู Logo.ุงูุงูุชุฏุงุฏ'
        required: false
        type: string
      
      video_url:
        description: 'ุฑุงุจุท ูุจุงุดุฑ ููููุฏูู (ููุถุน ุงูุฃููุงู ููุท)'
        required: false
        type: string
      
      video_name:
        description: 'ุงุณู ุงูููุฏูู (ุจุฏูู .mp4 - ุณูุชู ุฅุถุงูุชู ุชููุงุฆูุงู)'
        required: false
        default: 'movie'
        type: string
      
      # ุฅุนุฏุงุฏุงุช ูุถุน ุงููุณูุณูุงุช
      series_videos:
        description: 'ุจูุงูุงุช ุงููุณูุณูุงุช ุจุตูุบุฉ JSON ุญุชู 10 ูููุงุช. ูุซุงู: [{"url":"ุฑุงุจุท1","name":"ุงูุญููุฉ1"},{"url":"ุฑุงุจุท2","name":"ุงูุญููุฉ2"}]'
        required: false
        type: string
      
      skip_ssl:
        description: 'ุชุฎุทู ุชุญูู SSL (ููููุงูุน ุบูุฑ ุงูุขููุฉ ููุท)'
        required: false
        default: 'false'
        type: boolean

jobs:
  upload:
    runs-on: ubuntu-latest
    timeout-minutes: 90  # ูุฏุนู ุงููููุงุช ุงููุจูุฑุฉ
    
    steps:
      - name: ๐๏ธ ุฅุนุฏุงุฏ ุงูุจูุฆุฉ
        uses: actions/checkout@v4
        
      - name: โก ุชุซุจูุช ffmpeg (ูุนุฑุถ ุชูุงุตูู ุงูููุฏูู: ุงููุฏุฉ ูุงูุญุฌู)
        run: |
          sudo apt-get update
          sudo apt-get install -y ffmpeg
          ffmpeg -version
        
      - name: ๐ ุชุซุจูุช ุจุงูุซูู 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: ๐ฆ ุชุซุจูุช ุงูููุชุจุงุช ุงููุทููุจุฉ
        run: |
          pip install --upgrade pip setuptools
          pip install telethon requests "pysocks>=1.6.8" "cryptography>=3.0"
      
      - name: ๐ ุงูุชุญูู ูู ุงูุฃุณุฑุงุฑ
        env:
          TELEGRAM_API_ID: ${{ secrets.TELEGRAM_API_ID }}
          TELEGRAM_API_HASH: ${{ secrets.TELEGRAM_API_HASH }}
          TELEGRAM_SESSION_STRING: ${{ secrets.TELEGRAM_SESSION_STRING }}
        run: |
          if [ -z "$TELEGRAM_API_ID" ] || [ -z "$TELEGRAM_API_HASH" ] || [ -z "$TELEGRAM_SESSION_STRING" ]; then
            echo "โ ุฎุทุฃ: ุงููุชุบูุฑุงุช ุงูุณุฑูุฉ ุบูุฑ ููุชููุฉ!"
            echo "ุชุฃูุฏ ูู ูุฌูุฏ ูุฐู ุงูุฃุณุฑุงุฑ ูู Settings โ Secrets โ Actions:"
            echo "  โข TELEGRAM_API_ID"
            echo "  โข TELEGRAM_API_HASH"
            echo "  โข TELEGRAM_SESSION_STRING"
            exit 1
          fi
          echo "โ ุชู ุงูุชุญูู ูู ุงูุฃุณุฑุงุฑ ุจูุฌุงุญ"
      
      - name: ๐ ุชุดุบูู ุณูุฑูุจุช ุงูุฑูุน (ูุน ุชูุงุตูู ุงูููุฏูู)
        env:
          MODE: ${{ github.event.inputs.mode }}
          CHANNEL: ${{ github.event.inputs.channel }}
          CAPTION: ${{ github.event.inputs.caption }}
          IMAGE_URL: ${{ github.event.inputs.image_url }}
          VIDEO_URL: ${{ github.event.inputs.video_url }}
          VIDEO_NAME: ${{ github.event.inputs.video_name }}
          SERIES_VIDEOS: ${{ github.event.inputs.series_videos }}
          SKIP_SSL_VERIFY: ${{ github.event.inputs.skip_ssl }}
          TELEGRAM_API_ID: ${{ secrets.TELEGRAM_API_ID }}
          TELEGRAM_API_HASH: ${{ secrets.TELEGRAM_API_HASH }}
          TELEGRAM_SESSION_STRING: ${{ secrets.TELEGRAM_SESSION_STRING }}
          REPO_TOKEN: ${{ secrets.REPO_TOKEN }}
        run: |
          python upload.py || exit 1
      
      - name: โ ุงูุชูุงู ูุงุฌุญ
        if: success()
        run: |
          echo "=========================================="
          echo "๐ ุชูุช ุนูููุฉ ุงูุฑูุน ุจูุฌุงุญ!"
          echo "ุงููุถุน: ${{ github.event.inputs.mode }}"
          echo "ุงูููุงุฉ: ${{ github.event.inputs.channel }}"
          echo "ุงูุชูุงุตูู: ุงููุฏุฉ ูุงูุญุฌู ุธุงูุฑูู ูู ุงูุจูุณุช"
          echo "=========================================="
      
      - name: โ ูุดู ุงูุนูููุฉ
        if: failure()
        run: |
          echo "=========================================="
          echo "โ ูุดูุช ุนูููุฉ ุงูุฑูุน"
          echo "ุฑุงุฌุน ุงูุณุฌูุงุช ุฃุนูุงู ูุชูุงุตูู ุงูุฎุทุฃ"
          echo "=========================================="
