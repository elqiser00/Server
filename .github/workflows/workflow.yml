name: Upload Media to Telegram

on:
  workflow_dispatch:
    inputs:
      channel_url:
        description: 'ุฑุงุจุท ุงูููุงุฉ'
        required: true
        type: string
      media_type:
        description: 'ููุน ุงููุญุชูู'
        required: true
        default: 'ุฃููุงู'
        type: choice
        options:
          - ุฃููุงู
          - ูุณูุณูุงุช
      logo_url:
        description: 'ุฑุงุจุท ุงูุดุนุงุฑ'
        required: false
        type: string
      video_paths:
        description: 'ุฑูุงุจุท ุงูููุฏูู (ููุตููุฉ ุจููุงุตู)'
        required: true
        type: string
      caption:
        description: 'ุงููุตู'
        required: false
        type: string

jobs:
  upload:
    runs-on: ubuntu-latest
    
    steps:
    - name: ๐ฅ ุงุณุชุนุฑุงุถ ุงูููุฏ
      uses: actions/checkout@v4
      
    - name: ๐ ุฅุนุฏุงุฏ Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: ๐ฆ ุชุซุจูุช ุงูููุชุจุงุช
      run: |
        pip install telethon aiohttp
        
    - name: ๐งช ุงุฎุชุจุงุฑ ุงูุฅุนุฏุงุฏุงุช
      env:
        TELEGRAM_API_ID: ${{ secrets.TELEGRAM_API_ID }}
        TELEGRAM_API_HASH: ${{ secrets.TELEGRAM_API_HASH }}
        TELEGRAM_PHONE: ${{ secrets.TELEGRAM_PHONE }}
        TELEGRAM_SESSION_STRING: ${{ secrets.TELEGRAM_SESSION_STRING }}
      run: |
        echo "๐ ุงุฎุชุจุงุฑ ุงูุฅุนุฏุงุฏุงุช..."
        echo "API_ID: ${#TELEGRAM_API_ID} ุญุฑู"
        echo "API_HASH: ${#TELEGRAM_API_HASH} ุญุฑู"
        echo "PHONE: $TELEGRAM_PHONE"
        echo "SESSION: ${#TELEGRAM_SESSION_STRING} ุญุฑู"
        
        if [ -z "$TELEGRAM_API_ID" ] || [ -z "$TELEGRAM_API_HASH" ] || [ -z "$TELEGRAM_PHONE" ]; then
          echo "โ ุจูุงูุงุช ุงูุชููุฌุฑุงู ูุงูุตุฉ"
          exit 1
        fi
        
    - name: ๐ ุชุดุบูู ุงูุฑูุน
      env:
        TELEGRAM_API_ID: ${{ secrets.TELEGRAM_API_ID }}
        TELEGRAM_API_HASH: ${{ secrets.TELEGRAM_API_HASH }}
        TELEGRAM_PHONE: ${{ secrets.TELEGRAM_PHONE }}
        TELEGRAM_PASSWORD: ${{ secrets.TELEGRAM_PASSWORD || '' }}
        TELEGRAM_SESSION_STRING: ${{ secrets.TELEGRAM_SESSION_STRING || '' }}
        
        INPUT_CHANNEL_URL: ${{ inputs.channel_url }}
        INPUT_MEDIA_TYPE: ${{ inputs.media_type }}
        INPUT_LOGO_URL: ${{ inputs.logo_url }}
        INPUT_VIDEO_PATHS: ${{ inputs.video_paths }}
        INPUT_CAPTION: ${{ inputs.caption }}
      run: |
        echo "๐ ุจุฏุก ุงูุฑูุน..."
        python main.py
