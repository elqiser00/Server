name: Ø±ÙØ¹ ÙÙŠÙ„Ù… Ø¥Ù„Ù‰ ØªÙ„ÙŠØ¬Ø±Ø§Ù…

on:
  workflow_dispatch:
    inputs:
      channel:
        description: 'Ø±Ø§Ø¨Ø· Ø§Ù„Ù‚Ù†Ø§Ø©'
        required: true
        type: string
      movie:
        description: 'Ø§Ø³Ù… Ø§Ù„ÙÙŠÙ„Ù…'
        required: true
        type: string
      poster:
        description: 'Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©'
        required: true
        type: string
      video:
        description: 'Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ'
        required: true
        type: string

jobs:
  upload:
    runs-on: ubuntu-latest
    
    steps:
    - name: ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª
      run: |
        sudo apt update
        sudo apt install -y python3 python3-pip curl
        pip3 install telethon
        
    - name: ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª
      run: |
        curl -L --insecure -o poster.jpg "${{ github.event.inputs.poster }}"
        curl -L --insecure -o video.mp4 "${{ github.event.inputs.video }}"
        echo "Ø§Ù„Ù…Ù„ÙØ§Øª ØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡Ø§"
        
    - name: Ø¥Ù†Ø´Ø§Ø¡ Ø³ÙƒØ±Ø¨Øª Ø§Ù„Ø±ÙØ¹
      run: |
        cat > upload.py << 'PYTHON_EOF'
import asyncio, os
from telethon import TelegramClient
from telethon.sessions import StringSession

API_ID = int(os.environ['TELEGRAM_API_ID'])
API_HASH = os.environ['TELEGRAM_API_HASH']
SESSION = os.environ['TELEGRAM_SESSION_STRING']

async def main():
    print("Ø¨Ø¯Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…...")
    
    client = TelegramClient(StringSession(SESSION), API_ID, API_HASH)
    await client.connect()
    
    if not await client.is_user_authorized():
        print("Ø®Ø·Ø£: Ø§Ù„Ø¬Ù„Ø³Ø© ØºÙŠØ± ØµØ§Ù„Ø­Ø©")
        return
    
    print("ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…")
    
    channel = await client.get_entity('${{ github.event.inputs.channel }}')
    print(f"Ø§Ù„Ù‚Ù†Ø§Ø©: {channel.title}")
    
    print("Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø©...")
    await client.send_file(channel, 'poster.jpg', caption='ðŸŽ¬ ${{ github.event.inputs.movie }}')
    print("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø©")
    
    print("Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ...")
    video_size = os.path.getsize('video.mp4') / (1024 * 1024)
    caption = f'ðŸŽ¥ ${{ github.event.inputs.movie }}\\nÙÙŠÙ„Ù… ÙƒØ§Ù…Ù„\\nØ§Ù„Ø­Ø¬Ù…: {video_size:.2f} Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª'
    await client.send_file(channel, 'video.mp4', caption=caption, supports_streaming=True)
    print("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ")
    
    await client.disconnect()
    print("ØªÙ… Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ø¨Ù†Ø¬Ø§Ø­!")

asyncio.run(main())
PYTHON_EOF
        
    - name: ØªØ´ØºÙŠÙ„ Ø§Ù„Ø±ÙØ¹
      env:
        TELEGRAM_API_ID: ${{ secrets.TELEGRAM_API_ID }}
        TELEGRAM_API_HASH: ${{ secrets.TELEGRAM_API_HASH }}
        TELEGRAM_SESSION_STRING: ${{ secrets.TELEGRAM_SESSION_STRING }}
      run: |
        python3 upload.py
        
    - name: ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ù„ÙØ§Øª
      run: |
        rm -f poster.jpg video.mp4 upload.py
        echo "ØªÙ… Ø§Ù„ØªÙ†Ø¸ÙŠÙ"
